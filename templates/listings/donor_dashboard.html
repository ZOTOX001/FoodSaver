{% extends 'base.html' %}

{% block content %}
<div class="space-y-8 p-4 md:p-8 lg:p-10">
    <!-- Page Heading -->
    <div class="md:hidden mb-6">
        <h1 class="text-2xl font-black text-gray-900 dark:text-white">Dashboard</h1>
    </div>

    <!-- Impact Stats (Moved from Sidebar) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-primary/10 rounded-2xl p-6 border border-primary/20">
            <div class="flex items-center gap-3 mb-2">
                <div class="size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary">
                    <span class="material-symbols-outlined">scale</span>
                </div>
                <h3 class="text-xs font-bold uppercase tracking-wider text-[#4c9a4c]">Total Saved</h3>
            </div>
            <p class="text-3xl font-black text-[#0d1b0d] dark:text-white">1,240 <span
                    class="text-sm font-normal text-slate-500">kg</span></p>
        </div>
        <div class="bg-primary/10 rounded-2xl p-6 border border-primary/20">
            <div class="flex items-center gap-3 mb-2">
                <div class="size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary">
                    <span class="material-symbols-outlined">group</span>
                </div>
                <h3 class="text-xs font-bold uppercase tracking-wider text-[#4c9a4c]">People Fed</h3>
            </div>
            <p class="text-3xl font-black text-[#0d1b0d] dark:text-white">1,200</p>
        </div>
        <div class="bg-primary/10 rounded-2xl p-6 border border-primary/20">
            <div class="flex items-center gap-3 mb-2">
                <div class="size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary">
                    <span class="material-symbols-outlined">co2</span>
                </div>
                <h3 class="text-xs font-bold uppercase tracking-wider text-[#4c9a4c]">CO2 Avoided</h3>
            </div>
            <p class="text-3xl font-black text-[#0d1b0d] dark:text-white">3,100 <span
                    class="text-sm font-normal text-slate-500">kg</span></p>
        </div>
    </div>

    <!-- Main Layout Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <!-- Left Column: List New Surplus Form -->
        <div class="lg:col-span-5 space-y-6">
            <div
                class="bg-white dark:bg-[#152915] p-6 md:p-8 rounded-2xl border border-[#cfe7cf] dark:border-[#2a3d2a] shadow-sm">
                <div class="flex items-center gap-2 mb-6">
                    <span class="material-symbols-outlined text-primary">add_circle</span>
                    <h2 class="text-xl font-bold">List New Surplus</h2>
                </div>

                <!-- Create Listing Form -->
                <form method="post" enctype="multipart/form-data" action="{% url 'create_listing' %}" class="space-y-5">
                    {% csrf_token %}
                    <div class="space-y-2">
                        <label class="text-sm font-semibold">Food Type</label>
                        <select name="food_type"
                            class="w-full rounded-lg border-[#cfe7cf] dark:border-[#2a3d2a] bg-background-light dark:bg-[#0a1a0a] focus:ring-primary focus:border-primary text-sm p-3">
                            <option value="cooked">Cooked Meal</option>
                            <option value="raw">Raw Ingredients</option>
                            <option value="packaged">Packaged Food</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-sm font-semibold">Quantity (kg)</label>
                            <input type="number" name="quantity_kg" step="0.1"
                                class="w-full rounded-lg border-[#cfe7cf] dark:border-[#2a3d2a] bg-background-light dark:bg-[#0a1a0a] focus:ring-primary focus:border-primary text-sm p-3"
                                placeholder="e.g. 15" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-semibold">Expiry Time</label>
                            <input type="datetime-local" name="expiry_time"
                                class="w-full rounded-lg border-[#cfe7cf] dark:border-[#2a3d2a] bg-background-light dark:bg-[#0a1a0a] focus:ring-primary focus:border-primary text-sm p-3"
                                required>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-semibold">Description / Notes</label>
                        <textarea name="description"
                            class="w-full rounded-lg border-[#cfe7cf] dark:border-[#2a3d2a] bg-background-light dark:bg-[#0a1a0a] focus:ring-primary focus:border-primary text-sm p-3"
                            placeholder="Specify if any containers are needed..." rows="3"></textarea>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-semibold">Image</label>
                        <input type="file" name="image"
                            class="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20">
                    </div>
                    <button
                        class="w-full bg-primary hover:brightness-110 text-[#0d1b0d] font-bold py-3.5 rounded-lg text-base shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2"
                        type="submit">
                        <span class="material-symbols-outlined">publish</span>
                        Publish Surplus Listing
                    </button>
                </form>
            </div>

            <!-- Activity Feed (Incoming Claims) -->
            {% if claims %}
            <div class="bg-white dark:bg-[#152915] p-6 rounded-2xl border border-[#cfe7cf] dark:border-[#2a3d2a]">
                <h3 class="font-bold text-sm uppercase tracking-wider text-[#4c9a4c] mb-4">Incoming Claims</h3>
                <div class="space-y-4">
                    {% for claim in claims %}
                    <div class="flex items-center gap-3 border-b border-gray-100 pb-3">
                        <div class="size-8 rounded-full bg-primary/20 flex items-center justify-center text-primary">
                            <span class="material-symbols-outlined text-lg">check_circle</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Claimed by <span
                                    class="font-bold">{{claim.claimant.username}}</span></p>
                            <p class="text-xs opacity-60">{{claim.listing.get_food_type_display}} â€¢ {{claim.status}}</p>
                        </div>
                        <div>
                            {% if claim.status == 'pending' %}
                            <a href="{% url 'approve_claim' claim.id %}"
                                class="text-xs bg-primary text-white px-2 py-1 rounded font-bold hover:bg-green-600">Approve</a>
                            {% elif claim.status == 'approved' %}
                            <a href="{% url 'complete_claim' claim.id %}"
                                class="text-xs bg-blue-500 text-white px-2 py-1 rounded font-bold hover:bg-blue-600">Verify</a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Right Column: Interactive Map -->
        <div class="lg:col-span-7">
            <div
                class="bg-white dark:bg-[#152915] rounded-2xl border border-[#cfe7cf] dark:border-[#2a3d2a] overflow-hidden flex flex-col h-full min-h-[500px] shadow-sm">
                <div class="p-6 border-b border-[#cfe7cf] dark:border-[#2a3d2a] flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-bold">Nearby Active Requests</h3>
                        <p class="text-xs text-[#4c9a4c]">8 NGOs currently searching within 5km</p>
                    </div>
                    <div class="flex bg-[#e7f3e7] dark:bg-[#0a1a0a] p-1 rounded-lg">
                        <button
                            class="px-3 py-1 text-xs font-bold rounded-md bg-white dark:bg-primary/20 shadow-sm">Map</button>
                        <button class="px-3 py-1 text-xs font-bold rounded-md opacity-50">List</button>
                    </div>
                </div>
                <div class="relative flex-1 bg-gray-100 dark:bg-[#0a1a0a] overflow-hidden">
                    <!-- Simulated Map Background -->
                    <div class="absolute inset-0 grayscale opacity-40 dark:invert"
                        style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAx2nZOiwdgCz8sFUGI5BFSiEnpkmswBx9d-wcnLWNNoTVIll4htNugI6Ktyd9FMNPTO18Q3XsLUC8hQO6sehvTZV4cU89Tzm7tWbVJ0UdxQqb98r2ldSwhDMH_h7Fuo4BSiaE8b0Iawv3SWYT_FTCXSBtkakznfIjsumiiGyDqwBxqg90SiRXgaQyuRZNUOHscFpCrxKKCn91Qpe-FkqHNfObANjKOCYiuFuOKMpySGEEnhNstfAUpj-4w9O-zsW-CuWaHiS9YDOc'); background-size: cover; background-position: center;">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}